{"backend_state":"init","connection_file":"/tmp/xdg-runtime-user/jupyter/kernel-56c14a1c-c178-46eb-a007-c2b495b54e68.json","kernel":"python3","kernel_error":"","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"metadata":{"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.5"}},"trust":true,"type":"settings"}
{"cell_type":"code","exec_count":0,"id":"a1836f","input":"","pos":33,"type":"cell"}
{"cell_type":"code","exec_count":10,"id":"7c700e","input":"U, Sigma, VT = randomized_svd(new_df.to_numpy(), \n                              n_components=3,\n                              n_iter=5,\n                              random_state=None)","pos":29,"type":"cell"}
{"cell_type":"code","exec_count":10,"id":"8195a1","input":"def get_item_recommendations(compare_item, df, num_recom):\n    recs = []\n    for item in range(df.T.shape[0]):                                    # for each item except itself\n        if item != compare_item:\n#             print(df.T[compare_item],df.T[item], item)                 # uncomment this line if you need a better understanding of what is happening\n            recs.append((np.dot(df.T[compare_item],df.T[item]), item))   # calculate the dot product pairings between each of the items principal components\n    \n    recs.sort(reverse = True)                                   # sort in decending order of dot product value\n    final_rec = [recs[i][1] for i in range(num_recom)]          # create a list of the top num_recom most similar items\n    return final_rec\n\nitem = 0\nprint(f\"Items similar to item {item}: {get_item_recommendations(item,VT,3)}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Items similar to item 0: [4, 1, 3]\n"}},"pos":19,"type":"cell"}
{"cell_type":"code","exec_count":11,"id":"c93ec2","input":"def get_item_recommendations(compare_item, df, num_recom):\n    recs = []\n    for item in range(df.T.shape[0]):\n        if item != compare_item:\n            recs.append((np.dot(df.T[compare_item],df.T[item]), item))\n    recs.sort(reverse = True)\n    final_rec = [recs[i][1] for i in range(num_recom)]\n    return final_rec\n\nitem = 0\nprint(f\"Items similar to item {item}: {get_item_recommendations(item,VT,3)}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Items similar to item 0: [4, 1, 3]\n"}},"pos":30,"type":"cell"}
{"cell_type":"code","exec_count":11,"id":"e84a5a","input":"pd.DataFrame(U)","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0.153829</td>\n      <td>0.172063</td>\n      <td>0.622675</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.309746</td>\n      <td>-0.406234</td>\n      <td>-0.034642</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.564455</td>\n      <td>-0.013272</td>\n      <td>-0.137799</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.194181</td>\n      <td>0.497517</td>\n      <td>0.284851</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.147531</td>\n      <td>0.359208</td>\n      <td>-0.220491</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>0.564455</td>\n      <td>-0.013272</td>\n      <td>-0.137799</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0.147531</td>\n      <td>0.359208</td>\n      <td>-0.220491</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>0.309746</td>\n      <td>-0.406234</td>\n      <td>-0.034642</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0.210309</td>\n      <td>-0.073311</td>\n      <td>0.587291</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>0.147531</td>\n      <td>0.359208</td>\n      <td>-0.220491</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"          0         1         2\n0  0.153829  0.172063  0.622675\n1  0.309746 -0.406234 -0.034642\n2  0.564455 -0.013272 -0.137799\n3  0.194181  0.497517  0.284851\n4  0.147531  0.359208 -0.220491\n5  0.564455 -0.013272 -0.137799\n6  0.147531  0.359208 -0.220491\n7  0.309746 -0.406234 -0.034642\n8  0.210309 -0.073311  0.587291\n9  0.147531  0.359208 -0.220491"},"exec_count":11,"output_type":"execute_result"}},"pos":21,"type":"cell"}
{"cell_type":"code","exec_count":12,"id":"f6df69","input":"svd = TruncatedSVD(n_components=4)\nsvd_out = svd.fit_transform(df)\n\nplt.plot(np.cumsum(svd.explained_variance_ratio_), '.')\nplt.xlabel('component number')\nplt.ylabel('Cummulated fraction of explained variance')\nplt.xticks(range(4));","output":{"0":{"data":{"image/png":"7e3ce89ea178877980e8436b0dc74ab78233a2f9","text/plain":"<Figure size 864x504 with 1 Axes>"},"exec_count":12,"metadata":{"image/png":{"height":424,"width":720},"needs_background":"light"},"output_type":"execute_result"}},"pos":32,"type":"cell"}
{"cell_type":"code","exec_count":4,"id":"c3750f","input":"def get_item_recommendations(compare_item, df, num_recom):\n    recs = []\n    for item in range(num_items):\n        if item != compare_item:\n            recs.append((np.dot(df[compare_item],df[item]), item))\n    recs.sort(reverse = True)\n    final_rec = [recs[i][1] for i in range(num_recom)]\n    return final_rec\n\nitem = 0\nprint(f\"Items similar to item {item}: {get_item_recommendations(item,df,3)}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Items similar to item 0: [4, 2, 1]\n"}},"pos":9,"type":"cell"}
{"cell_type":"code","exec_count":5,"id":"5fd391","input":"U, Sigma, VT = randomized_svd(df.to_numpy(), \n                              n_components=3,\n                              n_iter=5,\n                              random_state=None)","pos":15,"type":"cell"}
{"cell_type":"code","exec_count":5,"id":"6963e1","input":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\n\nfrom sklearn.utils.extmath import randomized_svd\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.decomposition import TruncatedSVD","pos":1,"type":"cell"}
{"cell_type":"code","exec_count":6,"id":"0a9973","input":"pd.DataFrame(VT)","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0.566181</td>\n      <td>0.370786</td>\n      <td>0.510385</td>\n      <td>0.161386</td>\n      <td>0.505390</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-0.439392</td>\n      <td>0.070085</td>\n      <td>0.745835</td>\n      <td>0.287175</td>\n      <td>-0.404084</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.140944</td>\n      <td>0.201802</td>\n      <td>-0.379220</td>\n      <td>0.869133</td>\n      <td>-0.200525</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"          0         1         2         3         4\n0  0.566181  0.370786  0.510385  0.161386  0.505390\n1 -0.439392  0.070085  0.745835  0.287175 -0.404084\n2  0.140944  0.201802 -0.379220  0.869133 -0.200525"},"exec_count":6,"output_type":"execute_result"}},"pos":17,"type":"cell"}
{"cell_type":"code","exec_count":6,"id":"8ecff9","input":"compare_user = 2\nfor user in range(num_users):\n    if user != compare_user:\n        print(f\"User {compare_user} & {user}: Dot Product: {np.dot(df.T[compare_user],df.T[user])}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"User 2 & 0: Dot Product: 1\nUser 2 & 1: Dot Product: 2\nUser 2 & 3: Dot Product: 1\nUser 2 & 4: Dot Product: 1\nUser 2 & 5: Dot Product: 4\nUser 2 & 6: Dot Product: 1\nUser 2 & 7: Dot Product: 2\nUser 2 & 8: Dot Product: 1\nUser 2 & 9: Dot Product: 1\n"}},"pos":11,"type":"cell"}
{"cell_type":"code","exec_count":6,"id":"976d7a","input":"num_users = 10\nnum_items = 5","pos":4,"type":"cell"}
{"cell_type":"code","exec_count":7,"id":"4663fe","input":"def get_user_recommendations(compare_user, df, num_recom):\n    recs = []\n    for user in range(num_users):\n        if user != compare_user:\n            recs.append((np.dot(df.T[compare_user],df.T[user]), user))\n    recs.sort(reverse = True)\n    final_rec = [recs[i][1] for i in range(num_recom)]\n    return final_rec\n\nuser = 2\nprint(f\"Users similar to user {user}: {get_user_recommendations(user,df,3)}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Users similar to user 2: [5, 7, 1]\n"}},"pos":13,"type":"cell"}
{"cell_type":"code","exec_count":7,"id":"a53e9e","input":"df = pd.DataFrame(np.array([[0,1,0,1,0],[1,0,0,0,1],[1,1,1,0,1],[0,0,1,1,0],[0,0,1,0,0],[1,1,1,0,1],[0,0,1,0,0],\n                [1,0,0,0,1],[1,0,0,1,0],[0,0,1,0,0]]))\ndf","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"   0  1  2  3  4\n0  0  1  0  1  0\n1  1  0  0  0  1\n2  1  1  1  0  1\n3  0  0  1  1  0\n4  0  0  1  0  0\n5  1  1  1  0  1\n6  0  0  1  0  0\n7  1  0  0  0  1\n8  1  0  0  1  0\n9  0  0  1  0  0"},"exec_count":7,"output_type":"execute_result"}},"pos":5,"type":"cell"}
{"cell_type":"code","exec_count":7,"id":"a98eab","input":"def get_user_recommendations(compare_user, df, num_recom):\n    recs = []\n    for user in range(df.shape[0]):\n        if user != compare_user:\n            recs.append((np.dot(df[compare_user],df[user]), user))\n    recs.sort(reverse = True)\n    final_rec = [recs[i][1] for i in range(num_recom)]\n    return final_rec\n\nuser = 2\nprint(f\"Users similar to user {user}: {get_user_recommendations(user,U,3)}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Users similar to user 2: [5, 7, 1]\n"}},"pos":23,"type":"cell"}
{"cell_type":"code","exec_count":8,"id":"43d98a","input":"sc_X = StandardScaler()\nscaled_df = sc_X.fit_transform(df)\nscaled_df[0]","output":{"0":{"data":{"text/plain":"array([-1.        ,  1.52752523, -1.22474487,  1.52752523, -0.81649658])"},"exec_count":8,"output_type":"execute_result"}},"pos":25,"type":"cell"}
{"cell_type":"code","exec_count":8,"id":"81a75a","input":"compare_item = 0\nfor item in range(num_items):\n    if item != compare_item:\n        print(f\"Item {compare_item} & {item}: Dot Product = {np.dot(df[compare_item],df[item])}\")","output":{"0":{"name":"stdout","output_type":"stream","text":"Item 0 & 1: Dot Product = 2\nItem 0 & 2: Dot Product = 2\nItem 0 & 3: Dot Product = 1\nItem 0 & 4: Dot Product = 4\n"}},"pos":7,"type":"cell"}
{"cell_type":"code","exec_count":9,"id":"0174fd","input":"new_df = pd.DataFrame(scaled_df, columns = df.columns, index = df.index)\nnew_df.head()","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>0</th>\n      <th>1</th>\n      <th>2</th>\n      <th>3</th>\n      <th>4</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-1.0</td>\n      <td>1.527525</td>\n      <td>-1.224745</td>\n      <td>1.527525</td>\n      <td>-0.816497</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1.0</td>\n      <td>-0.654654</td>\n      <td>-1.224745</td>\n      <td>-0.654654</td>\n      <td>1.224745</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1.0</td>\n      <td>1.527525</td>\n      <td>0.816497</td>\n      <td>-0.654654</td>\n      <td>1.224745</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>-1.0</td>\n      <td>-0.654654</td>\n      <td>0.816497</td>\n      <td>1.527525</td>\n      <td>-0.816497</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>-1.0</td>\n      <td>-0.654654</td>\n      <td>0.816497</td>\n      <td>-0.654654</td>\n      <td>-0.816497</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"     0         1         2         3         4\n0 -1.0  1.527525 -1.224745  1.527525 -0.816497\n1  1.0 -0.654654 -1.224745 -0.654654  1.224745\n2  1.0  1.527525  0.816497 -0.654654  1.224745\n3 -1.0 -0.654654  0.816497  1.527525 -0.816497\n4 -1.0 -0.654654  0.816497 -0.654654 -0.816497"},"exec_count":9,"output_type":"execute_result"}},"pos":27,"type":"cell"}
{"cell_type":"markdown","id":"0b4fe0","input":"That's pretty much what a recommender system is doing for collaborative filtering, but it just works at a much bigger scale compared to this. On a larger scale, we won't want to perform the vector multiplication on every single item and user, but rather extract out the largest features using a singular value decomposition. Let's do that now. \n\nLet's truncate our system using 3 components of SVD. Note that the algorithm needs our input as a numpy array and not as a pandas dataframe:","pos":14,"type":"cell"}
{"cell_type":"markdown","id":"3197c2","input":"Notice that we can alter our get_item_recommendations function slightly (by using transposes in our multiplication formula) to find similar items to item 0. (Notice that when we used the 10 users in our calculations above then the similar item recommendations were [4, 1, 2]. Using only 3 feature vectors, the recommendations below are [4,1,3]. Pretty close!","pos":18,"type":"cell"}
{"cell_type":"markdown","id":"34a82e","input":"### Simplified example\n\nFirst, let's generate a really simple data set. Each row is a user, and each column is an item. If the value for a user:item location is 1; that user has \"liked\" that item. If it is a 0, then they do not like that item.","pos":3,"type":"cell"}
{"cell_type":"markdown","id":"3d0aec","input":"### Explained variance\nAs one last thing to note, it's helpful to visualize what increasing the number of components you use in your SVD decomposition will get you. Let's plot how the addition of each additional component included in our SVD decomposition increases the percentage of explained variance. Note that if we use a full number of components (equal to the number of features) then we approach 100%.","pos":31,"type":"cell"}
{"cell_type":"markdown","id":"55a408","input":"Let's generalize the above calculations in order to find a user that's most similar to another user. (Ex: User 2 is most similar to User 5 so therefore we'll recommend User 2 the movies that User 5 also likes.)","pos":12,"type":"cell"}
{"cell_type":"markdown","id":"6baedc","input":"However, the fit_transform algorithm returns the data in a numpy matrix, not a dataframe. Let's put it back into a dataframe in order to be able to use the same get_item_recommendations function that we made above:","pos":26,"type":"cell"}
{"cell_type":"markdown","id":"805bcd","input":"VT is now a matrix where each column represents one of the items in the new vector space. Each row is one component of the vector space, for the items:","pos":16,"type":"cell"}
{"cell_type":"markdown","id":"87a255","input":"We can generalize the above calculations in order to make a function that returns recommendations for a given item input (this user likes item 0... so she'll probably also like items X, Y, Z).","pos":8,"type":"cell"}
{"cell_type":"markdown","id":"94bfcb","input":"U is a matrix where each row is a user and each column shows the location in the hidden vector space created by the SVD:","pos":20,"type":"cell"}
{"cell_type":"markdown","id":"b57836","input":"### Recommendation systems\n\nRecommendation systems can be thought of as applying SVD to a User/Item matrix.\n\nIn this case our decomposition has a new interpretation:\n- $\\Sigma$ are the importances of each of our latent features\n- $U$ is a transformation from a person's buying habits/reviews to the latent features that represent their preferences\n- $V$ is a transformation from the list of people who like this item, to the latent features of the item\n\nBy setting a large number of our singular values (eigenvalues) to 0, and reconstructing the original matrix, we will gain an estimate of how much each user will like each item.","pos":2,"type":"cell"}
{"cell_type":"markdown","id":"bd4738","input":"Notice in the above matrix that items 0 and 4 have a lot of overlapping users. Users that like Item 0 tend to also like Item 4.\n\nSo if we take the dot products of items, we expect that items 0 & 4 are the most similar:","pos":6,"type":"cell"}
{"cell_type":"markdown","id":"c9ed2f","input":"Now, we're ready to perform our SVD decomposition:","pos":28,"type":"cell"}
{"cell_type":"markdown","id":"d24ebf","input":"We can also alter our get_user_recommendations function slightly (by NOT using transposes in our multiplication formula) to find similar users to user 2. (Notice that when we used the 4 items in our calculations above then the similar user recommendations to user 2 were [5, 7, 1]. Using only 3 feature vectors, the recommendations are [5, 7, 1]. An exact match!","pos":22,"type":"cell"}
{"cell_type":"markdown","id":"e20db5","input":"Now notice in the original matrix that users 2 and 5 like exactly the same items.\n\nIf we compare users, we expect that users 2 & 5 should be the most similar.","pos":10,"type":"cell"}
{"cell_type":"markdown","id":"f1f6c7","input":"Run the cell below to import the required packages:","pos":0,"type":"cell"}
{"cell_type":"markdown","id":"fc082c","input":"### Scaling is important\nSince our data only contained 0's and 1's in this example, scaling wasn't very important.  However, remember that when we use distance-based algorithms (which we are doing in this case) we should scale first. Let's scale our dataframe first:","pos":24,"type":"cell"}
{"id":0,"time":1621532378097,"type":"user"}
{"last_load":1621536830317,"type":"file"}