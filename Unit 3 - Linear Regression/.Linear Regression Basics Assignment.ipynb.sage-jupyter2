{"backend_state":"running","kernel":"python3","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":166371328},"metadata":{"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.7.3"}},"trust":true,"type":"settings"}
{"cell_type":"code","end":1568858786701,"exec_count":1,"id":"79fbe9","input":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\n%matplotlib inline\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import mean_squared_error\nfrom scipy.stats import pearsonr","kernel":"python3","pos":1,"start":1568858779556,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858786725,"exec_count":2,"id":"0bf471","input":"#write your answers in here","kernel":"python3","pos":4,"start":1568858786718,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858786801,"exec_count":3,"id":"7c14d2","input":"df = pd.read_csv('data/arizonastatetuition.csv')\ndf.head()","kernel":"python3","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year</th>\n      <th>Cost</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>0</td>\n      <td>1990</td>\n      <td>6546</td>\n    </tr>\n    <tr>\n      <td>1</td>\n      <td>1991</td>\n      <td>6996</td>\n    </tr>\n    <tr>\n      <td>2</td>\n      <td>1992</td>\n      <td>6996</td>\n    </tr>\n    <tr>\n      <td>3</td>\n      <td>1993</td>\n      <td>7350</td>\n    </tr>\n    <tr>\n      <td>4</td>\n      <td>1994</td>\n      <td>7500</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"   Year  Cost\n0  1990  6546\n1  1991  6996\n2  1992  6996\n3  1993  7350\n4  1994  7500"},"exec_count":3}},"pos":6,"start":1568858786734,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787480,"exec_count":4,"id":"9645c6","input":"X = df['Year']\nY = df['Cost']\nplt.plot(X, Y, '.')\nplt.xlabel('Year')\nplt.ylabel('Cost')","kernel":"python3","output":{"0":{"data":{"text/plain":"Text(0, 0.5, 'Cost')"},"exec_count":4},"1":{"data":{"image/png":"65e34c9defc160566d61def68578a32fda5a055b","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"image/png":{"height":261,"width":395}}}},"pos":8,"start":1568858786819,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787495,"exec_count":5,"id":"d38b47","input":"#insert answers here","kernel":"python3","pos":11,"start":1568858787488,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787531,"exec_count":6,"id":"530697","input":"#insert answers here","kernel":"python3","pos":14,"start":1568858787502,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787560,"exec_count":7,"id":"9b257d","input":"#insert answer here","kernel":"python3","pos":16,"start":1568858787542,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787594,"exec_count":8,"id":"7b351a","input":"pearsonr(X, Y)[0]","kernel":"python3","output":{"0":{"data":{"text/plain":"0.993158716292017"},"exec_count":8}},"pos":18,"start":1568858787567,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787635,"exec_count":9,"id":"b5dc99","input":"df.corr()","kernel":"python3","output":{"0":{"data":{"text/html":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year</th>\n      <th>Cost</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Year</td>\n      <td>1.000000</td>\n      <td>0.993159</td>\n    </tr>\n    <tr>\n      <td>Cost</td>\n      <td>0.993159</td>\n      <td>1.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>","text/plain":"          Year      Cost\nYear  1.000000  0.993159\nCost  0.993159  1.000000"},"exec_count":9}},"pos":20,"start":1568858787602,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787674,"exec_count":10,"id":"3c1480","input":"print(f\"X mean: {X.mean()}, Y mean: {Y.mean()}\")\nprint(f\"X std: {X.std()}, Y std: {Y.std()}\")","kernel":"python3","output":{"0":{"name":"stdout","text":"X mean: 1995.0, Y mean: 8070.363636363636\nX std: 3.3166247903554, Y std: 1088.940794784296\n"}},"pos":22,"start":1568858787645,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787700,"exec_count":11,"id":"73a623","input":"#insert exercise 5 answers","kernel":"python3","pos":24,"start":1568858787681,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858787817,"exec_count":12,"id":"b3c84f","input":"# Create an empty model\nmodel = LinearRegression()\n# Choose the response variable, which in this case is y\ny = df['Cost']\n# Choose the predictor variable, which in this case is X:\nX=df.drop('Cost', axis=1)\n# Fit the model to the full dataset\nmodel.fit(X, y)\n# print out intercept\nprint('b: ', model.intercept_)\n# print out other coefficients\nprint('m: ', model.coef_)","kernel":"python3","output":{"0":{"name":"stdout","text":"b:  -642462.8636363638\nm:  [326.08181818]\n"}},"pos":26,"start":1568858787712,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858788572,"exec_count":13,"id":"3eb3d6","input":"b = model.intercept_\nm = model.coef_[0]\nplt.plot(X,y,'.', label='actual')\nplt.plot(X, m*X+b, '.', label='predicted')\nplt.xlabel('number of claims')\nplt.ylabel('total payout in thousands of Kronor')\nplt.legend()","kernel":"python3","output":{"0":{"data":{"text/plain":"<matplotlib.legend.Legend at 0x7f06774aedd8>"},"exec_count":13},"1":{"data":{"image/png":"aad50543b15157c69b267502da868c5e322f16d7","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"image/png":{"height":261,"width":395}}}},"pos":29,"start":1568858787830,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789065,"exec_count":14,"id":"8e77e5","input":"plt.plot(X,y,'.', X, model.predict(X), '.');\nplt.xlabel('year');\nplt.ylabel('cost');","kernel":"python3","output":{"0":{"data":{"image/png":"b53a10258ee405fcf03db669e94e6ff12035a7df","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"image/png":{"height":261,"width":395}}}},"pos":31,"start":1568858788606,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789500,"exec_count":15,"id":"2bbf03","input":"plt.plot(X,y,'.', X, model.predict(X));\nplt.xlabel('year');\nplt.ylabel('cost');","kernel":"python3","output":{"0":{"data":{"image/png":"0367d0b9be07d9c0863c835beae8116bb20a9ebc","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"image/png":{"height":261,"width":395}}}},"pos":33,"start":1568858789085,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789518,"exec_count":16,"id":"1aa3fe","input":"model.predict([[2020]])","kernel":"python3","output":{"0":{"data":{"text/plain":"array([16222.40909091])"},"exec_count":16}},"pos":35,"start":1568858789510,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789544,"exec_count":17,"id":"17312c","input":"#insert exercise 6","kernel":"python3","pos":39,"start":1568858789524,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789572,"exec_count":18,"id":"49846b","input":"#insert answer","kernel":"python3","pos":41,"start":1568858789551,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858789998,"exec_count":19,"id":"fc612b","input":"plt.plot(X,y - model.predict(X), '.');\nplt.xlabel('year');\nplt.ylabel('residual');","kernel":"python3","output":{"0":{"data":{"image/png":"467be0e47e06ea704d860e4d5dfa02212c5651df","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"image/png":{"height":261,"width":397}}}},"pos":43,"start":1568858789589,"state":"done","type":"cell"}
{"cell_type":"code","end":1568858790011,"exec_count":20,"id":"dd4d62","input":"#insert exercise 8","kernel":"python3","pos":46,"start":1568858790006,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"06c391","input":"### Linear Regression By Hand\nIf a distribution is symmetric, unimodal, and bell-shaped, then we call it Normal. When a distribution is Normal, we use the mean to describe its center and its standard deviation to describe its spread. The formulas for these are:\n\n$\\bar{x} = \\frac{x_1+x_2+...x_n}{n}$\n\n$s=\\sqrt{\\frac{(x_1-\\bar{x})^2+(x_2-\\bar{x})^2+...+(x_n-\\bar{x})^2}{n-1}}$\n\nOn your own time if interested, you can explore why we take the “average” by dividing by n-1 instead of n, but this is beyond the scope of the class.","pos":2,"type":"cell"}
{"cell_type":"markdown","id":"0751b9","input":"### Exercise 1: \nA four person class has test scores of 80, 84, 84, 88. Calculate the mean and standard deviation by hand. ","pos":3,"type":"cell"}
{"cell_type":"markdown","id":"0981fe","input":"There seems to be a clear down-up pattern here, instead of a shapeless blob, and so we conclude that a linear model might not actually be appropriate!","pos":44,"type":"cell"}
{"cell_type":"markdown","id":"1444b6","input":"Going back to the Arizona State tuition example, we can find the correlation coefficient, r, by typing:","pos":17,"type":"cell"}
{"cell_type":"markdown","id":"144d2e","input":"### Linear Regression \nThe line of best fit is given by the equations\n$\\hat{y} = b + mx$, where\n$ b_1= r (\\frac{s_y}{s_x})$\nand \n$m = \\bar{y} - b_1 \\bar{x}$. \n\nTo find the means and standard deviations, we can type:","pos":21,"type":"cell"}
{"cell_type":"markdown","id":"15166a","input":"### Exercise 3:\nAll but one of the statements below contains a mistake. Explain what the mistakes are and explain which one could be true.\n\nA)  If the correlation between blood alcohol level and reaction time is 0.73, then the correlation between reaction time and blood alcohol level is -0.73.\n\nB)  The correlation between height and weight is 0.568 inches per pound.\n\nC)  The correlation between the breed of a dog and its weight is 0.435.\n\nD)  The correlation between weight and length of foot is 0.488.\n\nE)  The correlation between gender and age is -0.171. \n","pos":13,"type":"cell"}
{"cell_type":"markdown","id":"22fba0","input":"We can plot it:","pos":7,"type":"cell"}
{"cell_type":"markdown","id":"27bc85","input":"### Exercise 6:\nThe correlation coefficient, R, for protein (x) versus fat (y) for various Burger King items is given by $R=0.83.\n\na. Calculate R-Squared and describe what it tells you.\n\nb. What other factors might be affecting fat content?","pos":38,"type":"cell"}
{"cell_type":"markdown","id":"3328ea","input":"We can also obtain the line of best fit using the scikit-learn package:","pos":25,"type":"cell"}
{"cell_type":"markdown","id":"456711","input":"### Residuals\nA residual is given by the difference between the actual and predicted values, $y-\n\\hat{y}$.\n\nFor example, in the year 1990, since the actual tuition was 6546 dollars and the predicted tuition was 6440 dollars, the residual is +107 dollars. As a consumer, you would probably prefer to pay tuition during years when the residuals were negative, as that would indicate that you paid less than predicted by a linear model.\n\n### Exercise 7\nSuppose that you have a linear model for your class that compares the amount of sugar consumed daily versus the number of tooth cavities. Would you prefer to have a positive or negative residual. Why?","pos":40,"type":"cell"}
{"cell_type":"markdown","id":"5c249a","input":"### Exercise 2:\n\nWhich relationships could you possibly describe using correlation if the data was straight enough?\n\na.\tArizona state tuition over time.\n\nb.\tHurricane prediction error over time. \n\nc.\tThe role that having a high school diploma or not plays in income level.\n\nd.\tThe amount of calories that a person needs versus their weight.\n\ne.\tLifespan versus whether or not a person was a vegetarian.","pos":10,"type":"cell"}
{"cell_type":"markdown","id":"66346b","input":"### Correlation Does Not Imply Causation\nWhenever we have a strong correlation, it’s tempting to try to explain it by imagining that the predictor variable has caused the response to change. Don’t do it!\n\nExample: A scatterplot of damage in dollars caused to a house by fire would show a strong correlation with the number of firefighters at the scene. Does that mean that firefighters cause the damage? No! There is a lurking variable – the size of the blaze! Scatterplots and correlation coefficients NEVER prove causation. \n\n### Exercise 4:\nA study by a prominent psychologist found a moderately strong positive association between the number of hours of sleep a person gets and the personʹs ability to memorize information. \n\na. Explain in the context of this problem what ʺpositive associationʺ means.\n\n\nb. Hoping to improve academic performance, the psychologist recommended \tthe school board allow students to take a nap prior to any assessment. Discuss this reasoning.\n","pos":15,"type":"cell"}
{"cell_type":"markdown","id":"6778d1","input":"### Exercise 8:\nLet’s explore why certain shapes in the residual pattern are bad.  If your residual pattern has the shapes below, what might be wrong with using a linear model?\n![title](images/residuals.png)","pos":45,"type":"cell"}
{"cell_type":"markdown","id":"6be2a2","input":"If you prefer the line of best fit to be a line instead of dots, get rid of the period:","pos":32,"type":"cell"}
{"cell_type":"markdown","id":"818046","input":"- Correlation is always between -1 and 1. Correlation can be exactly equal to 1 or -1, but this is extremely unlikely with real data values.\n- r near +1 denotes a very strong positive correlation\n- r near -1 denotes a very strong negative correlation\n- r near zero denotes very weak correlation\n\nPlay around with the following applet to get a sense for correlation:\n\thttp://istics.net/stat/Correlations/\n\nCorrelation Properties:\n\n- The sign of a correlation coefficient gives the direction of the association.\n\n- Correlation is always between -1 and 1. Correlation can be exactly equal to 1 or -1, but this is extremely unlikely with real data values.\n\n- Correlation treats x and y symmetrically. The correlation of x with y is the same as the correlation of y with x.\n\n- Correlation has no units. \n\n- Correlation is not affected by the center or the scale of either variable (since z-scores are unaffected).\n\n- Correlation measures the strength of the linear association between the two variables. Variables can be strongly associated but still have a small correlation if the association isn’t linear.\n\n- Correlation is sensitive to outliers. \n\n\n","pos":12,"type":"cell"}
{"cell_type":"markdown","id":"82fd96","input":"If we wanted to plot the regression line manually, we could type:","pos":28,"type":"cell"}
{"cell_type":"markdown","id":"875f6c","input":"But luckily, we can use the predict method built in:","pos":30,"type":"cell"}
{"cell_type":"markdown","id":"8889ee","input":"### Correlation\n\nCorrelation measures the strength of the linear association between two quantitative variables. (Thus, there can be an association between two categorical variables, but there is not a correlation unless they are quantitative).  Before you use correlation, you must check several conditions:\n\n- **Quantitative Variables Condition**: Both variables must be quantitative. Variables such as gender or occupation are categorical, not quantitative.\n\n- **Straight Enough Condition**: Is the form of the scatterplot straight enough that a linear relationship makes sense? \n\n- **Outlier Condition**: Outliers can distort the correlation dramatically. It can make a weak correlation look strong or vice versa. When you see an outlier, it’s often a good idea to report the correlation with and without that point.","pos":9,"type":"cell"}
{"cell_type":"markdown","id":"8ca03d","input":"### R-squared\nThere is one more important idea to note besides slope and intercept. The correlation coefficient squared gives us an important value. Since $R=0.993$ in our Arizona State model, we have that $R^2=0.986$.  Without going into details, we will note that this gives us the fraction of the data’s variation that is accounted for in our model. \n\nFor example, since our $R^2$ is approximately 98.6%, this means that 98.6% of the variation in tuition is accounted for by year. The other 1.4% might have something to do with economic indicators, state budget, or other factors. Since 98.6% is a very high percentage, we say that our model has good predictive power.\n\nAs another example consider the graph below that shows hurricanes between 1970 and 2006 and the prediction error in nautical miles of the predicted position.\n![title](images/hurricanes.png)\n\nSuppose that the correlation coefficient for this model is $R=0.879$. Thus, $R^2=0.773$. Therefore, 77.3% of the variation in prediction error can be accounted for by year. Other factors, such as temperature and whether the storm lands over water or land, may explain some of the remaining variation. ","pos":37,"type":"cell"}
{"cell_type":"markdown","id":"92dfa0","input":"What would we predict tuition to be in 2020?","pos":34,"type":"cell"}
{"cell_type":"markdown","id":"958bf9","input":"The main package we'll use in this unit is [***scikit-learn***](http://scikit-learn.org/dev/index.html). It has a multitude of machine learning algorithms and a tremendous amount of functionality. \n\nIf you run this on cocalc, you won't need to download anything. If you are running this on your local computer,try running the following imports and check that they all import successfully. If the scikit-learn package fails to load, try typing\n\n``` \nconda install --upgrade scikit-learn\nor\npip install --upgrade scikit-learn\n```\nin a terminal command line.","pos":0,"type":"cell"}
{"cell_type":"markdown","id":"98e0be","input":"We can actually use the built-in capabilities of pandas to view correlation coefficients as well. Obviously, the correlation between a variable and itself is 1:","pos":19,"type":"cell"}
{"cell_type":"markdown","id":"a0ab01","input":"### sklearn: What's in a model?\n\nWoohoo! You just used your first scikit-learn model, LinearRegression. Essentially all models in `sklearn` inherit from the same type of \"estimator\" interface.  This means they'll share common methods that we'll see over and over again like:\n- `fit()`: Fit a model to a set of training data\n- `score()`: Score the performance of a model on a given sample of data with known ground truth dependent variables\n- `predict()`: Predict target/response variables based on a sample of independent variables (features, predictors, etc)\n\nAdditionally, models are usually loaded with other goodies once they've been fit, which can provide information about the resulting fitted model.  For instance, the ones we printed out above were:\n- `intercept_`: our $\\beta_0$ (intercept b in our regression model)\n- `coef_`: the other $\\beta$s (slope m in our model)","pos":36,"type":"cell"}
{"cell_type":"markdown","id":"b53a61","input":"### Exercise 5:\nCalculate the line of best fit by hand for the Arizona State tuition example by using the mean and standard deviation values above.","pos":23,"type":"cell"}
{"cell_type":"markdown","id":"d1e441","input":"### Residual Plot\nA residual plot is the scatterplot of the residuals $y-\n\\hat{y}$ against the explanatory variable x. \n\nRecall that calculating the least squares line required the quantitative variables, straight enough, and outliers conditions were satisfied. However, there is one more condition that we really need to check:\n\nDoes the Plot Thicken Condition: A scatterplot of the residuals versus the x-values should have no direction or shape. It should just be a blob of points. \n\nRecall the Arizona State Tuition scatterplot from above. This plot clearly satisfies the quantitative variables, straight enough, and outlier conditions. So a linear model should be appropriate, right?\n\nWell, let’s take a look at the residual plot: ","pos":42,"type":"cell"}
{"cell_type":"markdown","id":"d4bd88","input":"Let's view the the Arizona State Tuition Data Below:","pos":5,"type":"cell"}
{"cell_type":"markdown","id":"f04f01","input":"Note that a mean of $\\bar{Y}=326$ indicates that for each increase in year, the tuition is expected to rise by 326 dollars. A y-intercept of -642,462 indicates that in the year 0 A.D., we predict tuition to cost -642,462. Obviously, this does not make sense, as we extrapolated too far from the given range of x-values 1990-2000. Often, the y-intercept may not make much sense in context, but the slope should.","pos":27,"type":"cell"}
{"last_load":1568858676295,"type":"file"}